import void trace "imports" "trace" (u32);

// 16 MB memory reserved for virtual machines
u8[0x100_0000] vmMemory;

// Lookup structure for a 8K memory page
type blockLookup = struct {
  u32 readPtr,
  u32 writePtr,
  u8 flags,
  u8[7] reserved
};

// Memory page lookup table
blockLookup[8] blockLookupTable;

inline u8 readMemory(u16 addr) {
  local u32 page = addr >> 13;
  local u32 offset = addr & 0b0001_1111_1111_1111;
  return vmMemory[blockLookupTable[page].readPtr + offset];
}

u16 hl;

export void test() {
  local u8 a = readMemory(hl);
}